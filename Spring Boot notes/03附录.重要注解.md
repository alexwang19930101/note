# 重要注解与属性绑定

## 1.`@ConfigurationProperties`

### 1.1 yaml文件属性注入

```java
/**
 * @ConfigurationProperties将配置文件中的值进行映射
 * prefix = "person"说明在配置文件中的前缀
 * 这个bean也需要交给spring IOC容器管理
 *
 */
@Component
@ConfigurationProperties(prefix = "person")
public class Person{
    ...
}
```
为需要注入属性的bean添加注解(还需要添加**`spring-boot-configuration-processor`**的pom依赖处理这个注解)

```yaml
person:
  lastName: samier
  age: 15
  boss: false
  birth: 2007/11/11
  maps: {k1: v1,k2: v2}
  lists:
    - lisi
    - wangwu
  dog:
    name: aily
    age: 12
```

在application.yaml中添加上述类容

### 1.1 yaml文件属性注入

在application.properties添加以下内容

```properties
person.last-name=张三
person.age=12
person.boss=false
person.birth=2011/1/1
person.lists=1,2,3
person.maps.k1=v1
person.maps.k2=v2
person.dog.name=ali
person.dog.age=11
```



以上两种方式实质是相同的，但是yaml的数据结构阅读起来更加清晰。另外spring底层注解@Value也可以注入属性，不过每个去标记比较麻烦。

|          | @ConfigurationProperties                           | @Value   |
| -------- | -------------------------------------------------- | -------- |
| 注入     | 批量注入                                           | 单个注入 |
| 松散语法 | 自动转换（驼峰  \|\|  **-**分隔  \|\|  **_**分隔） | 不支持   |
| SpEL     | 不支持                                             | 支持     |
| JSR303   | 支持                                               | 不支持   |
| 复杂类型 | 支持（Map List等）                                 | 不支持   |



## 2.`@PropertySource`

将application.properties中的信息提取出来导入另外的文件中。

![1564066408653](C:\Users\wxy\Documents\GitNote\note\Spring Boot notes\springboot相关图片\@PropertySource注解.png)



## 3.`@ImportResource`

`@ImportResource`可以读取原来的spring framework的xml配置文件到工程中。

`@ImportResource`注解需要加在一个配置类上


![1564067000484](C:\Users\wxy\Documents\GitNote\note\Spring Boot notes\springboot相关图片\@ImportResource注解.png)

原本基于XML的配置也可以使用如下方式替代

```java
@Configuration
public class MyAppConfig {
    //@Bean将方法的返回值添加到IOC容器中，方法名就是bean的id
    @Bean
    public HelloService helloService(){
        return new HelloService();
    }
}
```



## 4.@ConditionalOnClass

```java
@Conditional(OnClassCondition.class)
public @interface ConditionalOnClass {
```

自动配置中使用的条件化注解
| 条件化注解                      | 配置生效条件                                                 |
| ------------------------------- | ------------------------------------------------------------ |
| @ConditionalOnBean              | 配置了某个特定Bean                                           |
| @ConditionalOnMissingBean       | 没有配置特定的Bean                                           |
| @ConditionalOnClass             | Classpath里有指定的类                                        |
| @ConditionalOnMissingClass      | Classpath里缺少指定的类                                      |
| @ConditionalOnExpression        | 给定的Spring Expression Language（SpEL）表达式计算结果为 true |
| @ConditionalOnJava              | Java的版本匹配特定值或者一个范围值                           |
| @ConditionalOnJndi              | 参数中给定的JNDI位置必须存在一个，如果没有给参数，则要有JNDI InitialContext |
| @ConditionalOnProperty          | 指定的配置属性要有一个明确的值                               |
| @ConditionalOnResource          | Classpath里有指定的资源                                      |
| @ConditionalOnWebApplication    | 这是一个Web应用程序                                          |
| @ConditionalOnNotWebApplication | 这不是一个Web应用程序                                        |